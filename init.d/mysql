#!/bin/bash
### BEGIN INIT INFO
# Provides:          mysql
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start/stop MySQL server
### END INIT INFO

# MySQL binary paths (adjust if needed)
MYSQLD="/usr/bin/mysqld_safe"
MYSQLADMIN="/usr/bin/mysqladmin"

# MySQL configuration
PIDFILE="/var/run/mysqld/mysqld.pid"
SOCKET="/var/run/mysqld/mysqld.sock"

# MySQL user
MYSQL_USER="mysql"

# Check for MySQL binaries
if [ ! -x "$MYSQLD" ] || [ ! -x "$MYSQLADMIN" ]; then
    echo "MySQL binaries not found."
    exit 1
fi

case "$1" in
    start)
        echo "Starting MySQL..."
        if [ -f "$PIDFILE" ]; then
            echo "MySQL is already running."
            exit 0
        fi
        start-stop-daemon --start --background --quiet --pidfile "$PIDFILE" --make-pidfile --exec "$MYSQLD" --user "$MYSQL_USER"
        echo "MySQL started."
        ;;
    stop)
        echo "Stopping MySQL..."
        if [ ! -f "$PIDFILE" ]; then
            echo "MySQL is not running."
            exit 0
        fi
        start-stop-daemon --stop --quiet --pidfile "$PIDFILE" --retry=TERM/30/KILL/5
        rm -f "$PIDFILE"
        echo "MySQL stopped."
        ;;
    restart)
        $0 stop
        $0 start
        ;;
    status)
        if [ -S "$SOCKET" ]; then
            echo "MySQL is running."
        else
            echo "MySQL is not running."
        fi
        ;;
    *)
        echo "Usage: $0 {start|stop|restart|status}"
        exit 1
        ;;
esac

exit 0
